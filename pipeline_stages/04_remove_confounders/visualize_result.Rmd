---
params:
  input_file: NULL
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.0'
      jupytext_version: 0.8.5
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
  language_info:
    codemirror_mode:
      name: ipython
      version: 3
    file_extension: .py
    mimetype: text/x-python
    name: python
    nbconvert_exporter: python
    pygments_lexer: ipython3
    version: 3.6.7
---

```{python}
# %load_ext autoreload
# %autoreload 2
import pandas as pd
import scanpy.api as sc
import numpy as np
import sys
sys.path.append("lib")
from jupytertools import setwd
from scio import concatenate
import gc
setwd()
```

```{python}
INPUT_FILE = r.params['input_file']
```

```{python}
adata = sc.read(INPUT_FILE)
```

## Visualize metadata

```{python}
if "X_pca" in adata.obsm:
    sc.pl.pca(adata, color=["dataset", "platform", "cell_type", "n_genes", "n_counts", "percent_mito", "phase", "patient", "origin"], ncols=2)
```

```{python}
sc.pl.umap(adata, color=["dataset", "platform", "cell_type", "n_genes", "n_counts", "percent_mito", "phase", "patient", "origin", "platform"], ncols=2)
```

```{python}
mcp_sig = pd.read_csv("tables/mcp_counter_signatures.txt", sep="\t")
cell_types = np.unique(mcp_sig["Cell population"].values)
```

```{python}
sc.pl.umap(adata, color=[ct for ct in cell_types if ct in adata.obs.columns], ncols=2)
```

```{python}
sc.pl.umap(adata, color="cell_type")
```
