---
title: "R Notebook"
output: html_document
---

```{r}
library(edgeR)
library(dplyr)
library(readr)
```


```{r}
r_mat = read_delim("../../results/downstream_analysis/edger/r_mat.csv", delim=" ", col_names=FALSE)
r_obs = read_csv("../../results/downstream_analysis/edger/r_obs.csv")
r_genes = read_csv("../../results/downstream_analysis/edger/r_genes.csv")
```

```{r}
r_obs2 = r_obs %>% 
  mutate(dataset = as.factor(dataset),
         cluster_label1 = as.factor(cluster_label1),
         cluster_label2 = as.factor(cluster_label2))

```


```{r}
design = model.matrix(~cluster_label1 + dataset + n_genes + percent_mito, data=r_obs)
dge = DGEList(counts=r_mat, samples=r_obs, genes=r_genes)
dge <- calcNormFactors(dge)
dge <- estimateDisp(dge, design = design)
fit <- glmQLFit(dge, design = design)
qlf <- glmQLFTest(fit)
tt <- topTags(qlf, n = Inf)

```